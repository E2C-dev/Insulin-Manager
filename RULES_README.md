# インスリン調整ルール管理

## 概要

このシステムでは、血糖値に基づいてインスリン量を自動調整するルールを設定できます。

## 時間帯の種類

4つのタイミングでルールを設定できます：

1. **朝（朝食）** - 朝食時のインスリン調整
2. **昼（昼食）** - 昼食時のインスリン調整
3. **夕（夕食）** - 夕食時のインスリン調整
4. **眠前** - 就寝前のインスリン調整

## ルールの構成要素

各ルールは以下の要素で構成されます：

### 1. ルール名
- 例: "朝食後高血糖対応"、"夜間低血糖対応"

### 2. 時間帯
- 朝、昼、夕、眠前のいずれか

### 3. 条件設定
- **条件タイプ**: 例）食後1h血糖値、夜間血糖値、朝食前血糖値
- **閾値**: 例）70、100、140（mg/dL）
- **比較**: 以下、以上、未満、超える

### 4. 調整内容
- **調整量**: -20〜+20単位
- **調整対象**: 例）翌日朝食、眠前、翌日昼食

## デフォルトルール

システムには以下のデフォルトルールが用意されています：

### 眠前インスリンの調整（3ルール）

1. **夜間低血糖対応（優先度：高）**
   - 条件: 夜間血糖値 ≤ 70mg/dL
   - 調整: 眠前 -2単位

2. **朝の低血糖対応**
   - 条件: 朝食前血糖値 ≤ 70mg/dL
   - 調整: 眠前 -1単位

3. **朝の高血糖対応**
   - 条件: 朝食前血糖値 ≥ 100mg/dL
   - 調整: 眠前 +2単位

### 朝食インスリンの調整（2ルール）

1. **朝食後高血糖対応**
   - 条件: 食後1h血糖値 ≥ 140mg/dL
   - 調整: 翌日朝食 +2単位

2. **朝食後低血糖対応**
   - 条件: 食後1h血糖値 ≤ 80mg/dL
   - 調整: 翌日朝食 -1単位

### 昼食インスリンの調整（2ルール）

1. **昼食後高血糖対応**
   - 条件: 食後1h血糖値 ≥ 140mg/dL
   - 調整: 翌日昼食 +2単位

2. **昼食後低血糖対応**
   - 条件: 食後1h血糖値 ≤ 80mg/dL
   - 調整: 翌日昼食 -1単位

### 夕食インスリンの調整（2ルール）

1. **夕食後高血糖対応**
   - 条件: 食後1h血糖値 ≥ 140mg/dL
   - 調整: 翌日夕食 +2単位

2. **夕食後低血糖対応**
   - 条件: 食後1h血糖値 ≤ 80mg/dL
   - 調整: 翌日夕食 -1単位

## 使い方

### 1. ルールの表示
- 画面上部のタブ（朝・昼・夕・眠前）をクリックして、各時間帯のルールを確認できます
- タブには現在登録されているルール数が表示されます

### 2. 新規ルールの追加
1. 対象の時間帯のタブを選択
2. 「新規ルール」ボタンをクリック
3. フォームに必要事項を入力
4. 「作成」ボタンをクリック

### 3. ルールの編集
1. 編集したいルールのカードで「編集」アイコンをクリック
2. フォームで値を修正
3. 「更新」ボタンをクリック

### 4. ルールの削除
1. 削除したいルールのカードで「削除」アイコンをクリック
2. 確認ダイアログで「OK」をクリック

## デフォルトルールの登録

ユーザーアカウントにデフォルトルールを一括登録するには：

```bash
# ユーザーIDを確認
npx tsx script/list-users.ts

# デフォルトルールを登録
npx tsx script/seed-rules.ts <ユーザーID>
```

## カスタマイズのヒント

### 閾値の調整
- 体質や状態に応じて閾値を調整できます
- 例: 低血糖の閾値を70から80に変更

### 調整量の変更
- インスリンの感受性に応じて調整量を変更できます
- 例: +2単位を+1単位に減らす、-1単位を-2単位に増やす

### 複数ルールの組み合わせ
- 同じ時間帯に複数のルールを設定可能
- 優先度の高いルールを明示的に名前に記載することを推奨

## 注意事項

⚠️ **重要**: このシステムは医療機器ではありません。必ず医師の指導のもとで使用してください。

- ルールはあくまで参考値です
- 実際のインスリン調整は医師と相談して決定してください
- 定期的にルールの見直しを行ってください
